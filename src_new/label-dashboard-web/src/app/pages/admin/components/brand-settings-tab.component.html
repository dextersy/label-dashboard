<form [formGroup]="brandForm" (ngSubmit)="saveBrandSettings()" *ngIf="brandSettings">
  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header"><h5>General Settings</h5></div>
        <div class="card-body">
          <div class="form-group mb-3">
            <label for="logo">Logo</label><br>
            <img [src]="brandSettings.logo_url || 'assets/img/placeholder.jpg'" 
                 width="250" style="background-color:#cccccc; margin-bottom: 10px;"><br>
            <input type="file" class="form-control" id="logo" 
                   accept=".jpg,.png" (change)="onLogoFileSelected($event)" />
          </div>
          
          <div class="form-group mb-3">
            <label for="name">Name</label>
            <input type="text" class="form-control" id="name" 
                   formControlName="name" placeholder="Brand Name">
          </div>
          
          <div class="form-group mb-3">
            <label for="brand_website">Website 
              <i class="fas fa-info-circle" title="This will be linked to your logo. Include http or https in the URL"></i>
            </label>
            <input type="text" class="form-control" id="brand_website" 
                   formControlName="brand_website" placeholder="Brand Website">
          </div>
          
          <div class="form-group mb-3">
            <label for="brand_color">Brand color</label>
            <div class="d-flex align-items-center gap-3">
              <!-- Color Preview -->
              <div class="color-preview d-flex align-items-center justify-content-center rounded border" 
                   [style.background-color]="brandForm.get('brand_color')?.value"
                   style="width: 60px; height: 45px; min-width: 60px; border: 2px solid #dee2e6;">
                <i class="fas fa-palette text-white" 
                   style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5); font-size: 18px;"></i>
              </div>
              
              <!-- Color Picker -->
              <input type="color" class="form-control color-picker" id="brand_color" 
                     formControlName="brand_color" 
                     style="width: 80px; height: 45px; padding: 4px; border-radius: 6px;">
              
              <!-- Hex Value Input -->
              <div class="flex-grow-1">
                <input type="text" class="form-control" 
                       [value]="brandForm.get('brand_color')?.value?.toUpperCase()" 
                       (input)="onHexColorChange($event)"
                       placeholder="#800080" 
                       pattern="^#[0-9A-Fa-f]{6}$"
                       style="font-family: 'Courier New', monospace; letter-spacing: 1px;">
                <small class="text-muted">Enter hex color code (e.g., #800080)</small>
              </div>
            </div>
          </div>
          
          <div class="form-group mb-3">
            <label for="favicon">Favicon</label><br>
            <div class="input-group">
              <div class="input-group-text">
                <img [src]="brandSettings.favicon_url || 'assets/img/placeholder.jpg'" 
                     width="20" style="background-color:#cccccc;">
              </div>
              <input type="file" class="form-control" id="favicon" 
                     accept=".png" (change)="onFaviconFileSelected($event)" />
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card">
        <div class="card-header"><h5>Catalog</h5></div>
        <div class="card-body">
          <div class="form-group mb-3">
            <label for="catalog_prefix">Catalog Prefix 
              <i class="fas fa-info-circle" title="For autogenerated catalog number (e.g. CAT001)"></i>
            </label>
            <input type="text" class="form-control" id="catalog_prefix" 
                   formControlName="catalog_prefix" placeholder="Catalog Prefix">
          </div>
          
          <div class="form-group mb-3">
            <label for="release_submission_url">Release Submission URL 
              <i class="fas fa-info-circle" title="Link to the form where your artists should submit their releases."></i>
            </label>
            <input type="text" class="form-control" id="release_submission_url" 
                   formControlName="release_submission_url" placeholder="Release Submission URL">
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header"><h5>Payments</h5></div>
        <div class="card-body">
          <div class="form-group mb-3">
            <label for="paymongo_wallet_id">Paymongo Wallet ID (optional)</label>
            <div class="input-group">
              <input [type]="showPaymongoWalletId ? 'text' : 'password'" 
                     class="form-control" 
                     id="paymongo_wallet_id" 
                     formControlName="paymongo_wallet_id" 
                     placeholder="Paymongo Wallet ID">
              <button type="button" 
                      class="btn btn-outline-secondary password-toggle-btn" 
                      (click)="togglePaymongoWalletIdVisibility()"
                      title="Toggle password visibility">
                <i class="fas" [class.fa-eye]="!showPaymongoWalletId" [class.fa-eye-slash]="showPaymongoWalletId"></i>
              </button>
            </div>
          </div>
          
          <div class="form-group mb-3">
            <label for="processing_fee">Processing fee for payouts</label>
            <div class="input-group">
              <div class="input-group-text">â‚±</div>
              <input type="number" class="form-control" id="processing_fee" 
                     formControlName="payment_processing_fee_for_payouts" 
                     placeholder="Payment processing fee" min="0" step="0.01">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="row save-panel mt-3">
    <button type="submit" class="btn btn-primary btn-block" [disabled]="loading">
      <i class="fas fa-save"></i> Save Changes
    </button>
  </div>
</form>

<!-- Domains Section -->
<hr>
<div class="row">
  <div class="col-md-4">
    <div class="card">
      <div class="card-header"><h3>Domains</h3></div>
      <div class="card-body">
        <p>These domains will resolve to your dashboard.</p>
        
        <div class="table-responsive" *ngIf="domains.length > 0">
          <table class="table">
            <tbody>
              <tr *ngFor="let domain of domains">
                <td>
                  <i [class]="getStatusIcon(domain.status)" 
                     [title]="getStatusTooltip(domain.status)"></i>
                  {{ domain.domain_name }}
                </td>
                <td>
                  <button *ngIf="shouldShowVerifyButton(domain.status)" 
                     (click)="verifyDomain(domain.domain_name)" 
                     class="btn btn-link btn-sm"
                     [disabled]="isVerifyButtonDisabled(domain.domain_name, domain.status)"
                     [class.text-muted]="isVerifyButtonDisabled(domain.domain_name, domain.status)"
                     [title]="getVerifyButtonTooltip(domain.domain_name, domain.status)"
                     style="padding: 0; border: none; background: none; text-decoration: underline;">
                    [ {{ getVerifyButtonText(domain.status) }} ]
                  </button>
                  <span *ngIf="domain.status === 'Connected'" 
                        class="text-success small">
                    <i class="fas fa-check"></i> Connected
                  </span>
                  <span *ngIf="domain.status === 'Pending'" 
                        class="text-info small">
                    <i class="fas fa-clock fa-spin"></i> Processing...
                  </span>
                  <a (click)="deleteDomain(domain.domain_name)" 
                     class="btn btn-link btn-sm text-danger ms-2"
                     title="Delete domain">
                    <i class="fas fa-trash"></i>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div *ngIf="domains.length === 0">
          No domains configured.
        </div>
        
        <h4>Add domain</h4>
        <div class="input-group">
          <input type="text" class="form-control" [(ngModel)]="newDomainName" placeholder="Domain name">
          <button type="button" class="btn btn-primary" (click)="addDomain()">Add</button>
        </div>
      </div>
    </div>
  </div>
</div>