<div class="child-brands-tab">
  <!-- Date Range Filter -->
  <app-date-range-filter
    [loading]="loading"
    [compact]="false"
    (dateRangeChange)="onDateRangeChange($event)"
    (refresh)="onRefreshData()">
  </app-date-range-filter>

  <app-paginated-table
    title="Sublabels"
    [data]="sortedChildBrands"
    [columns]="tableColumns"
    [loading]="loading"
    [pagination]="pagination"
    [showSearch]="true"
    [showSortableHeaders]="true"
    [showActionsColumn]="true"
    [sortInfo]="sortInfo"
    (sortChange)="onSortChange($event)">
    
    <ng-template #customButtons>
      <button *ngIf="isSuperAdmin()" 
              class="btn btn-primary btn-sm"
              (click)="openAddSublabelModal()"
              [disabled]="loading || sublabelCreationState.inProgress"
              [title]="sublabelCreationState.inProgress ? 'Please wait for current sublabel creation to complete' : 'Add new sublabel'">
        <span *ngIf="!sublabelCreationState.inProgress">
          <i class="fas fa-plus"></i> Add
        </span>
        <span *ngIf="sublabelCreationState.inProgress">
          <i class="fas fa-spinner fa-spin"></i> Creating {{ sublabelCreationState.pendingName }}...
        </span>
      </button>
    </ng-template>

    <ng-template #actionsContent let-item>
      <button
        class="btn btn-sm btn-outline-primary d-none d-md-inline-block"
        [disabled]="!hasDomains(item)"
        (click)="openSublabelDashboard(item)"
        [title]="hasDomains(item) ? 'Go to ' + item.brand_name + ' dashboard' : 'No domain configured'">
        <i class="fas fa-external-link-alt"></i>
      </button>
      
      <button
        class="btn btn-sm btn-outline-primary d-md-none d-block w-100"
        [disabled]="!hasDomains(item)"
        (click)="openSublabelDashboard(item)">
        <i class="fas fa-external-link-alt me-2"></i>
        Go to Dashboard
      </button>
    </ng-template>
  </app-paginated-table>

  <!-- Summary Cards -->
  <div class="row mt-4" *ngIf="!loading && childBrands.length > 0">
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card summary-card">
        <div class="card-body text-center">
          <h4 class="card-title text-primary">₱{{ getTotalBalance() | number:'1.2-2' }}</h4>
          <p class="card-text text-muted">Total Balance</p>
        </div>
      </div>
    </div>
    
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card summary-card">
        <div class="card-body text-center">
          <h4 class="card-title text-info">₱{{ getTotalMusicEarnings() | number:'1.2-2' }}</h4>
          <p class="card-text text-muted">Total Music Earnings</p>
        </div>
      </div>
    </div>
    
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card summary-card">
        <div class="card-body text-center">
          <h4 class="card-title text-warning">₱{{ getTotalEventEarnings() | number:'1.2-2' }}</h4>
          <p class="card-text text-muted">Total Event Earnings</p>
        </div>
      </div>
    </div>
    
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card summary-card">
        <div class="card-body text-center">
          <h4 class="card-title text-secondary">₱{{ getTotalCommission() | number:'1.2-2' }}</h4>
          <p class="card-text text-muted">Total Commission</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Sublabel Modal -->
  <app-add-sublabel-modal
    [show]="showAddSublabelModal"
    (close)="closeAddSublabelModal()"
    (submit)="onCreateSublabel($event)">
  </app-add-sublabel-modal>
</div>