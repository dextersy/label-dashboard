<div class="admin-page">
  <div class="container-fluid">

    <!-- Tab Navigation -->
    <div class="card tab-navigation">
      <div class="card-header">
        <ul class="nav nav-pills admin-tabs" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link" [class.active]="activeTab === 'brand'" 
               (click)="setActiveTab('brand')" role="tab">
              <i class="fas fa-cog"></i> Brand Settings
            </a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" [class.active]="activeTab === 'summary'" 
               (click)="setActiveTab('summary')" role="tab">
              <i class="fas fa-chart-bar"></i> Summary View
            </a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" [class.active]="activeTab === 'balance'" 
               (click)="setActiveTab('balance')" role="tab">
              <i class="fas fa-balance-scale"></i> Balance Summary
            </a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" [class.active]="activeTab === 'bulk-add-earnings'" 
               (click)="setActiveTab('bulk-add-earnings')" role="tab">
              <i class="fas fa-plus-circle"></i> Bulk Add Earnings
            </a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" [class.active]="activeTab === 'users'" 
               (click)="setActiveTab('users')" role="tab">
              <i class="fas fa-users"></i> Users
            </a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" [class.active]="activeTab === 'child-brands'" 
               (click)="setActiveTab('child-brands')" role="tab">
              <i class="fas fa-sitemap"></i> Sublabels
            </a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" [class.active]="activeTab === 'tools'" 
               (click)="setActiveTab('tools')" role="tab">
              <i class="fas fa-tools"></i> Tools
            </a>
          </li>
        </ul>
      </div>

      <div class="card-body">
        <div class="tab-content">
          <!-- Brand Settings Tab -->
          <div class="tab-pane" [class.active]="activeTab === 'brand'">
            <form [formGroup]="brandForm" (ngSubmit)="saveBrandSettings()" *ngIf="brandSettings">
              <div class="row">
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header"><h5>General Settings</h5></div>
                    <div class="card-body">
                      <div class="form-group mb-3">
                        <label for="logo">Logo</label><br>
                        <img [src]="brandSettings.logo_url || 'assets/img/placeholder.jpg'" 
                             width="250" style="background-color:#cccccc; margin-bottom: 10px;"><br>
                        <input type="file" class="form-control" id="logo" 
                               accept=".jpg,.png" (change)="onLogoFileSelected($event)" />
                      </div>
                      
                      <div class="form-group mb-3">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" 
                               formControlName="name" placeholder="Brand Name">
                      </div>
                      
                      <div class="form-group mb-3">
                        <label for="brand_website">Website 
                          <i class="fas fa-info-circle" title="This will be linked to your logo. Include http or https in the URL"></i>
                        </label>
                        <input type="text" class="form-control" id="brand_website" 
                               formControlName="brand_website" placeholder="Brand Website">
                      </div>
                      
                      <div class="form-group mb-3">
                        <label for="brand_color">Brand color 
                          <span [style.color]="brandForm.get('brand_color')?.value">
                            <i class="fas fa-square"></i>
                          </span>
                        </label>
                        <select class="form-control" formControlName="brand_color">
                          <option value="purple">Purple</option>
                          <option value="red">Red</option>
                          <option value="blue">Blue</option>
                          <option value="azure">Azure</option>
                          <option value="green">Green</option>
                          <option value="black">Black</option>
                          <option value="white">White</option>
                        </select>
                      </div>
                      
                      <div class="form-group mb-3">
                        <label for="favicon">Favicon</label><br>
                        <div class="input-group">
                          <div class="input-group-text">
                            <img [src]="brandSettings.favicon_url || 'assets/img/placeholder.jpg'" 
                                 width="20" style="background-color:#cccccc;">
                          </div>
                          <input type="file" class="form-control" id="favicon" 
                                 accept=".png" (change)="onFaviconFileSelected($event)" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header"><h5>Catalog</h5></div>
                    <div class="card-body">
                      <div class="form-group mb-3">
                        <label for="catalog_prefix">Catalog Prefix 
                          <i class="fas fa-info-circle" title="For autogenerated catalog number (e.g. CAT001)"></i>
                        </label>
                        <input type="text" class="form-control" id="catalog_prefix" 
                               formControlName="catalog_prefix" placeholder="Catalog Prefix">
                      </div>
                      
                      <div class="form-group mb-3">
                        <label for="release_submission_url">Release Submission URL 
                          <i class="fas fa-info-circle" title="Link to the form where your artists should submit their releases."></i>
                        </label>
                        <input type="text" class="form-control" id="release_submission_url" 
                               formControlName="release_submission_url" placeholder="Release Submission URL">
                      </div>
                    </div>
                  </div>
                  
                  <div class="card">
                    <div class="card-header"><h5>Payments</h5></div>
                    <div class="card-body">
                      <div class="form-group mb-3">
                        <label for="processing_fee">Processing fee for payouts</label>
                        <div class="input-group">
                          <div class="input-group-text">₱</div>
                          <input type="number" class="form-control" id="processing_fee" 
                                 formControlName="payment_processing_fee_for_payouts" 
                                 placeholder="Payment processing fee" min="0" step="0.01">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="row save-panel mt-3">
                <button type="submit" class="btn btn-primary btn-block" [disabled]="loading">
                  <i class="fas fa-save"></i> Save Changes
                </button>
              </div>
            </form>

            <!-- Domains Section -->
            <hr>
            <div class="row">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header"><h3>Domains</h3></div>
                  <div class="card-body">
                    <p>These domains will resolve to your dashboard.</p>
                    
                    <div class="table-responsive" *ngIf="domains.length > 0">
                      <table class="table">
                        <tbody>
                          <tr *ngFor="let domain of domains">
                            <td>
                              <i [class]="getStatusIcon(domain.status)" 
                                 [title]="getStatusTooltip(domain.status)"></i>
                              {{ domain.domain_name }}
                            </td>
                            <td>
                              <a *ngIf="domain.status !== 'Verified'" 
                                 (click)="verifyDomain(domain.domain_name)" 
                                 class="btn btn-link btn-sm"
                                 title="Click to verify domain">
                                [ Verify ]
                              </a>
                              <span *ngIf="domain.status === 'Verified'" 
                                    class="text-success small">
                                <i class="fas fa-check"></i> Verified
                              </span>
                              <a (click)="deleteDomain(domain.domain_name)" 
                                 class="btn btn-link btn-sm text-danger ms-2"
                                 title="Delete domain">
                                <i class="fas fa-trash"></i>
                              </a>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    
                    <div *ngIf="domains.length === 0">
                      No domains configured.
                    </div>
                    
                    <h4>Add domain</h4>
                    <div class="input-group">
                      <input type="text" class="form-control" [(ngModel)]="newDomainName" placeholder="Domain name">
                      <button type="button" class="btn btn-primary" (click)="addDomain()">Add</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Summary View Tab -->
          <div class="tab-pane" [class.active]="activeTab === 'summary'">
            <div class="row mb-3">
              <div class="col-md-3">
                <div class="form-group">
                  <label for="dateRange">Select date range</label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="dateRange" 
                           [(ngModel)]="dateRange" placeholder="MM/DD/YYYY - MM/DD/YYYY" />
                    <button class="btn btn-outline-secondary" type="button" (click)="filterSummaryData()">
                      <i class="fas fa-filter"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <h3>Earnings Summary</h3>
            <div class="row" *ngIf="earningsSummary">
              <div class="col-md-3">
                <div class="card">
                  <div class="card-header">
                    <h4 class="title"><i class="fas fa-shopping-bag"></i> Physical Earnings</h4>
                  </div>
                  <div class="card-body text-center">
                    <h5>{{ formatCurrency(earningsSummary.physical_earnings) }}</h5>
                  </div>
                </div>
              </div>
              
              <div class="col-md-3">
                <div class="card">
                  <div class="card-header">
                    <h4 class="title"><i class="fas fa-download"></i> Download Earnings</h4>
                  </div>
                  <div class="card-body text-center">
                    <h5>{{ formatCurrency(earningsSummary.download_earnings) }}</h5>
                  </div>
                </div>
              </div>
              
              <div class="col-md-3">
                <div class="card">
                  <div class="card-header">
                    <h4 class="title"><i class="fas fa-headphones"></i> Streaming Earnings</h4>
                  </div>
                  <div class="card-body text-center">
                    <h5>{{ formatCurrency(earningsSummary.streaming_earnings) }}</h5>
                  </div>
                </div>
              </div>
              
              <div class="col-md-3">
                <div class="card">
                  <div class="card-header">
                    <h4 class="title"><i class="fas fa-tv"></i> Sync Earnings</h4>
                  </div>
                  <div class="card-body text-center">
                    <h5>{{ formatCurrency(earningsSummary.sync_earnings) }}</h5>
                  </div>
                </div>
              </div>
            </div>

            <h3>Payments and Royalties Summary</h3>
            <div class="row" *ngIf="paymentsRoyaltiesSummary">
              <!-- Implementation pending API response structure -->
              <div class="col-md-12">
                <p class="text-muted">Payments and royalties summary will be displayed here.</p>
              </div>
            </div>
          </div>

          <!-- Balance Summary Tab -->
          <div class="tab-pane" [class.active]="activeTab === 'balance'">
            <h3>Balance Summary</h3>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Artist</th>
                    <th class="text-end">Total royalties (₱)</th>
                    <th class="text-end">Total payments (₱)</th>
                    <th class="text-end">Total balance (₱)</th>
                    <th class="text-end">Payout point (₱)</th>
                    <th class="text-center">Due for payment</th>
                    <th class="text-center">Payouts paused</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let artist of artistBalances">
                    <td>{{ artist.name }}</td>
                    <td class="text-end">{{ formatCurrency(artist.total_royalties) }}</td>
                    <td class="text-end">{{ formatCurrency(artist.total_payments) }}</td>
                    <td class="text-end fw-bold">{{ formatCurrency(artist.total_balance) }}</td>
                    <td class="text-end">{{ formatCurrency(artist.payout_point) }}</td>
                    <td class="text-center">
                      <i class="fas fa-check" *ngIf="artist.due_for_payment"></i>
                    </td>
                    <td class="text-center">
                      <i class="fas fa-pause-circle" *ngIf="artist.hold_payouts"></i>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h4 class="title">Total Balance</h4>
                  </div>
                  <div class="card-body text-center">
                    <h3><strong>{{ formatCurrency(totalBalance) }}</strong></h3>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h4 class="title">Total Due For Payment</h4>
                  </div>
                  <div class="card-body text-center">
                    <h3><strong>{{ formatCurrency(totalDueForPayment) }}</strong></h3>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h4 class="title">Ready to Pay <i class="fas fa-info-circle" title="Due for payment and has bank account"></i></h4>
                  </div>
                  <div class="card-body text-center">
                    <h3><strong>{{ formatCurrency(readyForPayment) }}</strong></h3>
                    <button class="btn btn-primary btn-block" 
                            [disabled]="readyForPayment <= 0 || walletBalance < readyForPayment"
                            (click)="payAllBalances()">
                      <i class="fas fa-credit-card"></i> Pay Now
                    </button>
                    <small><strong>On hold:</strong> {{ formatCurrency(pausedPayouts) }}</small>
                  </div>
                  <div class="card-footer text-center">
                    <div class="badge bg-info">
                      Available balance: {{ formatCurrency(walletBalance) }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Bulk Add Earnings Tab -->
          <div class="tab-pane" [class.active]="activeTab === 'bulk-add-earnings'">
            <h3>Bulk Add Earnings</h3>
            <div class="row mb-3">
              <div class="col-md-3">
                <strong>Current total earnings:</strong> 
                <span>{{ formatCurrency(totalEarnings) }}</span>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Release</th>
                    <th>Earning Date</th>
                    <th>Earning Type</th>
                    <th>Earning Description</th>
                    <th>Earning Amount</th>
                    <th>Calculate royalties</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Apply to all row -->
                  <tr style="background-color:#f1f1f1;">
                    <td><em>Apply to all</em></td>
                    <td>
                      <input type="date" class="form-control" #applyAllDateInput 
                             (change)="applyAllDate(applyAllDateInput.value)">
                    </td>
                    <td>
                      <select class="form-control" #applyAllTypeInput 
                              (change)="applyAllType(applyAllTypeInput.value)">
                        <option value="Sync">Sync</option>
                        <option value="Streaming">Streaming</option>
                        <option value="Downloads">Downloads</option>
                        <option value="Physical">Physical</option>
                      </select>
                    </td>
                    <td>
                      <input type="text" class="form-control" #applyAllDescInput placeholder="Description" 
                             (change)="applyAllDescription(applyAllDescInput.value); applyAllDescInput.value = ''">
                    </td>
                    <td></td>
                    <td>
                      <input type="checkbox" class="form-check-input" #applyAllCalcInput 
                             checked (change)="applyAllCalculateRoyalties(applyAllCalcInput.checked)">
                    </td>
                  </tr>

                  <!-- Data rows -->
                  <tr *ngFor="let earning of bulkEarnings; let i = index">
                    <td>
                      <select class="form-control" [(ngModel)]="earning.release_id">
                        <option value="0"></option>
                        <option *ngFor="let release of releases" [value]="release.id">
                          {{ release.catalog_no }}: {{ release.title }}
                        </option>
                      </select>
                    </td>
                    <td>
                      <input type="date" class="form-control" [(ngModel)]="earning.date_recorded">
                    </td>
                    <td>
                      <select class="form-control" [(ngModel)]="earning.type">
                        <option value="Sync">Sync</option>
                        <option value="Streaming">Streaming</option>
                        <option value="Downloads">Downloads</option>
                        <option value="Physical">Physical</option>
                      </select>
                    </td>
                    <td>
                      <input type="text" class="form-control" [(ngModel)]="earning.description" 
                             placeholder="Description">
                    </td>
                    <td>
                      <div class="input-group">
                        <div class="input-group-text">₱</div>
                        <input type="number" class="form-control" step="0.01" min="0" 
                               [(ngModel)]="earning.amount" placeholder="Amount" 
                               (ngModelChange)="onBulkAmountChange()">
                      </div>
                    </td>
                    <td>
                      <input type="checkbox" class="form-check-input" 
                             [(ngModel)]="earning.calculate_royalties">
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <button type="button" class="btn btn-primary" (click)="saveBulkEarnings()" [disabled]="loading">
              Save All Earnings
            </button>
          </div>

          <!-- Users Tab -->
          <div class="tab-pane" [class.active]="activeTab === 'users'">
            <div class="row">
              <div class="col-md-6">
                <app-paginated-table 
                  title="Users"
                  [data]="users"
                  [pagination]="usersPagination"
                  [loading]="usersLoading"
                  (pageChange)="loadUsers($event)">
                  <ng-template #tableContent let-data>
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Username</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email address</th>
                            <th>Last logged in</th>
                            <th>Is administrator</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let user of data">
                            <td>{{ user.username }}</td>
                            <td>{{ user.first_name }}</td>
                            <td>{{ user.last_name }}</td>
                            <td>{{ user.email_address }}</td>
                            <td>{{ formatDate(user.last_logged_in || '') }}</td>
                            <td>{{ user.is_admin ? '✔️' : '' }}</td>
                            <td>
                              <a (click)="toggleAdminStatus(user.id)" class="btn btn-link btn-sm">
                                {{ user.is_admin ? 'Remove admin' : 'Make admin' }}
                              </a>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </ng-template>
                </app-paginated-table>
              </div>

              <div class="col-md-6">
                <app-paginated-table 
                  title="Recent Login Attempts"
                  [data]="loginAttempts"
                  [pagination]="loginAttemptsPagination"
                  [loading]="loginAttemptsLoading"
                  (pageChange)="loadLoginAttempts($event)">
                  <ng-template #tableContent let-data>
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Username</th>
                            <th>Name</th>
                            <th>Time</th>
                            <th>Result</th>
                            <th>Remote IP</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let attempt of data">
                            <td>{{ attempt.username }}</td>
                            <td>{{ attempt.name }}</td>
                            <td>{{ formatDate(attempt.date_and_time) }}</td>
                            <td>{{ attempt.result }}</td>
                            <td>{{ attempt.remote_ip }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </ng-template>
                </app-paginated-table>
              </div>
            </div>
          </div>

          <!-- Sublabels Tab -->
          <div class="tab-pane" [class.active]="activeTab === 'child-brands'">
            <div class="placeholder-content">
              <div class="text-center">
                <i class="fas fa-sitemap fa-3x"></i>
                <h4>Sublabels Management</h4>
                <p class="text-muted">Sublabel management functionality will be implemented here.</p>
              </div>
            </div>
          </div>

          <!-- Tools Tab -->
          <div class="tab-pane" [class.active]="activeTab === 'tools'">
            <div class="placeholder-content">
              <div class="text-center">
                <i class="fas fa-tools fa-3x"></i>
                <h4>Admin Tools</h4>
                <p class="text-muted">Administrative tools and utilities will be available here.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>