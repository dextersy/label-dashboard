<div class="artist-gallery-tab">
  
  <!-- Upload Section -->
  <div class="card upload-section">
    <div class="card-header">
      <h5>Upload Photos</h5>
    </div>
    <div class="card-body">
      <div class="upload-area">
        <input type="file" 
               id="photoUpload" 
               class="form-control-file" 
               multiple 
               accept="image/jpeg,image/jpg,image/png,image/gif"
               (change)="onFilesSelected($event)">
        <label for="photoUpload" class="upload-label">
          <i class="fas fa-cloud-upload-alt fa-3x"></i>
          <p>Click to select photos or drag and drop</p>
          <small>Supported formats: JPEG, PNG, GIF (Max 10MB each)</small>
        </label>
      </div>
      
      <div *ngIf="selectedFiles && selectedFiles.length > 0" class="selected-files">
        <h6>Selected Files:</h6>
        <ul>
          <li *ngFor="let file of getSelectedFilesArray(); let i = index">
            {{ file.name }} ({{ (file.size / 1024 / 1024).toFixed(2) }}MB)
          </li>
        </ul>
      </div>
      
      <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="progress">
        <div class="progress-bar" 
             role="progressbar" 
             [style.width.%]="uploadProgress">
          {{ uploadProgress }}%
        </div>
      </div>
      
      <button type="button" 
              class="btn btn-primary upload-btn" 
              (click)="uploadPhotos()"
              [disabled]="!selectedFiles || selectedFiles.length === 0 || uploading">
        <div class="loading-spinner" *ngIf="uploading"></div>
        <i class="fa fa-upload" *ngIf="!uploading"></i>
        {{ uploading ? 'Uploading...' : 'Upload Photos' }}
      </button>
    </div>
  </div>

  <!-- Gallery Section -->
  <div class="card gallery-section">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5>Photo Gallery</h5>
      <div class="filter-controls">
        <div class="btn-group btn-group-sm d-none d-md-flex" role="group">
          <input type="radio" class="btn-check" name="epkFilter" id="epkFilterAll" value="all" [(ngModel)]="epkFilter" autocomplete="off">
          <label class="btn btn-outline-secondary" for="epkFilterAll">All</label>

          <input type="radio" class="btn-check" name="epkFilter" id="epkFilterVisible" value="visible" [(ngModel)]="epkFilter" autocomplete="off">
          <label class="btn btn-outline-info" for="epkFilterVisible">
            <i class="fa fa-globe"></i> Visible in EPK
          </label>

          <input type="radio" class="btn-check" name="epkFilter" id="epkFilterHidden" value="hidden" [(ngModel)]="epkFilter" autocomplete="off">
          <label class="btn btn-outline-warning" for="epkFilterHidden">
            <i class="fa fa-eye-slash"></i> Hidden from EPK
          </label>
        </div>
        <select class="form-select form-select-sm d-md-none" [(ngModel)]="epkFilter">
          <option value="all">All</option>
          <option value="visible">Visible in EPK</option>
          <option value="hidden">Hidden from EPK</option>
        </select>
      </div>
    </div>
    <div class="card-body">
      
      <div *ngIf="loading" class="text-center">
        <div class="loading-dots">
          <div></div>
          <div></div>
          <div></div>
        </div>
      </div>
      
      <div *ngIf="!loading && photos.length === 0" class="text-center text-muted empty-gallery">
        <i class="fa fa-camera fa-3x"></i>
        <p>No photos uploaded yet</p>
        <small>Upload your first photo to get started!</small>
      </div>

      <div *ngIf="!loading && photos.length > 0 && filteredPhotos.length === 0" class="text-center text-muted empty-gallery">
        <i class="fa fa-filter fa-3x"></i>
        <p>No photos match the current filter</p>
        <small>Try changing the EPK visibility filter above</small>
      </div>
      
      <div *ngIf="!loading && filteredPhotos.length > 0" class="photo-grid">
        <div class="photo-item" *ngFor="let photo of filteredPhotos">
          <div class="photo-container">
            <img [src]="getPhotoUrl(photo)" 
                 [alt]="photo.caption || 'Artist photo'"
                 class="photo-image"
                 (dblclick)="onPhotoDoubleClick(photo)">
            
            <div class="photo-overlay">
              <div class="photo-actions">
                <button class="btn btn-sm btn-info btn-icon-only" 
                        (click)="openLightbox(photo)"
                        title="View photo">
                  <i class="fa fa-eye"></i>
                </button>
                <button class="btn btn-sm btn-info btn-icon-only" 
                        (click)="setAsProfilePhoto(photo)"
                        title="Set as profile photo">
                  <i class="fa fa-user"></i>
                </button>
                <button class="btn btn-sm btn-icon-only" 
                        [ngClass]="photo.exclude_from_epk ? 'btn-warning' : 'btn-info'"
                        (click)="toggleExcludeFromEPK(photo)"
                        [title]="photo.exclude_from_epk ? 'Excluded from EPK (click to include)' : 'Included in EPK (click to exclude)'">
                  <i class="fa" [ngClass]="photo.exclude_from_epk ? 'fa-eye-slash' : 'fa-globe'"></i>
                </button>
                <button class="btn btn-sm btn-info btn-icon-only" 
                        (click)="startEditingCaption(photo)"
                        *ngIf="!editingCaptions[photo.id]"
                        title="Edit caption">
                  <i class="fa fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger btn-icon-only" 
                        (click)="deletePhoto(photo)"
                        title="Delete photo">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div class="photo-caption">
            <div *ngIf="!editingCaptions[photo.id]" class="caption-display">
              <p *ngIf="photo.caption" class="caption-text">{{ photo.caption }}</p>
              <p *ngIf="!photo.caption" class="caption-empty">No caption</p>
              <small class="caption-date">{{ formatDate(photo.upload_date) }}</small>
            </div>
            
            <div *ngIf="editingCaptions[photo.id]" class="caption-edit">
              <textarea class="form-control caption-input" 
                        [(ngModel)]="editingCaptionTexts[photo.id]"
                        placeholder="Enter photo caption..."
                        rows="2"></textarea>
              <div class="caption-actions">
                <button class="btn btn-sm btn-success" 
                        (click)="saveCaption(photo)">
                  <i class="fa fa-check"></i> Save
                </button>
                <button class="btn btn-sm btn-secondary" 
                        (click)="cancelEditingCaption(photo.id)">
                  <i class="fa fa-times"></i> Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Lightbox -->
  <app-lightbox 
    [imageUrl]="lightboxImageUrl"
    [imageAlt]="lightboxImageAlt"
    [caption]="lightboxCaption"
    [isVisible]="showLightbox"
    (close)="closeLightbox()">
  </app-lightbox>
  
</div>