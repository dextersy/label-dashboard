<div class="document-viewer-overlay" *ngIf="isVisible" (click)="onBackdropClick($event)">
  <div class="document-viewer-modal">
    <div class="document-viewer-header">
      <div class="document-info">
        <i [class]="'fa ' + getFileIcon()"></i>
        <div class="document-details">
          <h5 class="document-title">{{ document?.title }}</h5>
          <small class="document-filename text-muted">{{ document?.filename }}</small>
        </div>
      </div>
      <div class="document-actions">
        <button 
          type="button" 
          class="btn btn-outline-secondary btn-sm me-2"
          (click)="downloadDocument()"
          title="Download">
          <i class="fa fa-download"></i>
        </button>
        <button 
          type="button" 
          class="btn btn-outline-secondary btn-sm me-2"
          (click)="openInNewTab()"
          title="Open in new tab">
          <i class="fas fa-external-link-alt"></i>
        </button>
        <button 
          type="button" 
          class="btn btn-outline-secondary btn-sm"
          (click)="onClose()"
          title="Close">
          <i class="fa fa-times"></i>
        </button>
      </div>
    </div>

    <div class="document-viewer-content">
      <!-- Loading indicator -->
      <div *ngIf="loading" class="document-loading">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading document...</p>
      </div>

      <!-- PDF Viewer -->
      <div *ngIf="documentType === 'pdf'" class="pdf-viewer">
        <iframe 
          [src]="safeUrl"
          width="100%" 
          height="100%"
          frameborder="0"
          (load)="onPdfLoad()"
          [style.display]="loading ? 'none' : 'block'">
        </iframe>
      </div>

      <!-- Image Viewer -->
      <div *ngIf="documentType === 'image'" class="image-viewer">
        <img 
          [src]="document?.url" 
          [alt]="document?.title"
          class="document-image"
          (load)="onImageLoad()"
          (error)="onImageError()"
          [style.display]="loading ? 'none' : 'block'">
      </div>

      <!-- Office Documents -->
      <div *ngIf="documentType === 'office'" class="office-viewer">
        <div class="office-preview">
          <i [class]="'fa fa-5x ' + getFileIcon()"></i>
          <h4 class="mt-3">{{ document?.title }}</h4>
          <p class="text-muted">Office documents cannot be previewed directly.</p>
          <div class="mt-3">
            <button 
              type="button" 
              class="btn btn-primary me-2"
              (click)="downloadDocument()">
              <i class="fa fa-download me-1"></i>
              Download Document
            </button>
            <button 
              type="button" 
              class="btn btn-outline-primary"
              (click)="openInNewTab()">
              <i class="fas fa-external-link-alt me-1"></i>
              Open in New Tab
            </button>
          </div>
        </div>
      </div>

      <!-- Text Documents -->
      <div *ngIf="documentType === 'text'" class="text-viewer">
        <iframe 
          [src]="safeUrl"
          width="100%" 
          height="100%"
          frameborder="0"
          (load)="onPdfLoad()"
          [style.display]="loading ? 'none' : 'block'">
        </iframe>
      </div>

      <!-- Unsupported Documents -->
      <div *ngIf="documentType === 'unsupported'" class="unsupported-viewer">
        <div class="unsupported-preview">
          <i class="fa fa-file fa-5x text-muted"></i>
          <h4 class="mt-3">{{ document?.title }}</h4>
          <p class="text-muted">This file type cannot be previewed.</p>
          <div class="mt-3">
            <button 
              type="button" 
              class="btn btn-primary me-2"
              (click)="downloadDocument()">
              <i class="fa fa-download me-1"></i>
              Download Document
            </button>
            <button 
              type="button" 
              class="btn btn-outline-primary"
              (click)="openInNewTab()">
              <i class="fas fa-external-link-alt me-1"></i>
              Open in New Tab
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>